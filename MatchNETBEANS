package net.codejava.sql;

import java.awt.EventQueue;
import java.awt.LayoutManager;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.border.EmptyBorder;
import java.util.*;
import java.sql.*;
import javax.swing.JTextField;
import javax.swing.DefaultListModel;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.AbstractListModel;
import java.awt.Color;

public class Match extends JFrame {

		private JPanel contentPane;
	    public static int position;
	    
	    public void setPosition(int a){
			position = a;
	    }
	    
	    public static boolean thereIsAtLeastABuddy;
	    private JTextField textField_1 = new JTextField();
	    private final JButton btnNewButton = new JButton("Like");
	    private final JLabel lblNewLabel = new JLabel("Your possible travel buddy:");
	    DefaultListModel model = new DefaultListModel();
	    private final JButton btnNewButton_1 = new JButton("load matches");
	    public ArrayList<Integer> matchingUsersProfile() throws ClassNotFoundException {
	    	thereIsAtLeastABuddy = false;
	        List<Integer> allowlike = new ArrayList<Integer>();
	        
	        try{
	        	Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");
				String url = "jdbc:sqlserver://" +"TZINA-PC" + ":1433;DatabaseName=" + "TRABUDZ" + ";encrypt=true;trustServerCertificate=true";
	            String user = "LSD";
	            String passWord = "LSD123";
	            Connection conn = DriverManager.getConnection(url, user, passWord);
	            System.out.println("connected successfully to Database");
	            Statement stmt1 = conn.createStatement();
	            Statement stmt2 = conn.createStatement();
	            Statement stmt = conn.createStatement();
	            ResultSet rs1= null;
	            ResultSet rs2 = null;
	            ResultSet rs = null;
	        
	            String sql2 = "SELECT COUNT(*) FROM USERS" ; //αριθμος σειρων βασης
	            rs = stmt.executeQuery(sql2);
	            rs.next();
	            int x = rs.getInt(1);
	            
	            try {
	                String sqlfortheuser = "select DEST, MONTHY from USERS where POSITION=" + String.valueOf(position);
	                rs1 = stmt1.executeQuery(sqlfortheuser);
	                while(rs1.next()) {
	                	for(int i = 1;i<=x; i++) {        
	                		try {
	                        	String sql = "select DEST, MONTHY, USERNAME from USERS where POSITION=" + String.valueOf(i);
	                        	rs2 = stmt2.executeQuery(sql);
	                        	while (rs2.next()) {
	                                if (rs1.getInt("DEST") == rs2.getInt("DEST") && i != position && rs1.getString("MONTHY").equals(rs2.getString("MONTHY"))) { 
	                                		if (thereIsAtLeastABuddy == false) {
	                                			System.out.println("Your possible travel Buddies are :");
	                                			thereIsAtLeastABuddy = true;
	                                		}
	                                		System.out.println(rs2.getString("USERNAME"));
	                                		model.addElement(rs2.getString("USERNAME"));
	                                		allowlike.add(i);
	                                }
	                        	}
	                        } catch (SQLException e) {
	                            System.out.println(e);
	                        }
	                       
	                    }
	                    
	                }
	                main("");
	            } catch (SQLException e) {
	                System.out.println(e);
	            }
	            conn.close();
	        }catch (SQLException e){
	            System.out.println("SQLException :");
	        }
	        if (thereIsAtLeastABuddy == false) {
	            System.out.println("We're sorry but there isn't any travel buddy for you. Please try again with new destination info");
	            return (ArrayList<Integer>) allowlike;
	        }else {
	            return (ArrayList<Integer>) allowlike;
	        }
	        
	    }
	    
	    public boolean getBoolean() {
	    	return thereIsAtLeastABuddy;
	    }
	    
	  
	

	/**
	 * Launch the application.
	 */
		public static void main(String args) {
			EventQueue.invokeLater(new Runnable() {
				public void run() {
					try {
						Match frame = new Match();
						frame.setVisible(true);
					} catch (Exception e) {
						e.printStackTrace();
					}
				}
			});
		}
	
		/**
		 * Create the frame.
		 */
		public Match() {
			textField_1.setBounds(149, 252, 181, 32);
			textField_1.setColumns(10);
			JList list = new JList();
			list.setBounds(112, 54, 227, 144);
			contentPane.add(list);
			initGUI();
		}
		private void initGUI() {
			setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
			setBounds(100, 100, 500, 332);
			contentPane = new JPanel();
			contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));
			
			setContentPane(contentPane);
			contentPane.setLayout(null);
			
			contentPane.add(textField_1);
			btnNewButton.setBounds(362, 257, 89, 23);
			
			contentPane.add(btnNewButton);
			lblNewLabel.setBounds(161, 11, 176, 20);
			contentPane.add(lblNewLabel);
			
			btnNewButton_1.setBounds(10, 116, 99, 38);
			contentPane.add(btnNewButton_1);
			btnNewButton_1.addActionListener(new ActionListener() {
				public void actionPerformed(ActionEvent arg0) {
					list.setModel(model);
				
			    }
		});
		}
}
